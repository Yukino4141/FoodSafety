# 食安卫士 V1.0 功能文档

## 📌 版本信息
- **版本号**: V1.0
- **发布日期**: 2025-12-22
- **开发周期**: 2周
- **项目定位**: 食品安全扫码查询小程序(MVP版本)

---

## 🎯 V1.0 核心功能

### 一、管理端功能

#### 1.1 员工管理
- **员工登录**: 账号密码登录，生成JWT令牌
- **权限控制**: 基于JWT的接口鉴权

#### 1.2 商品管理(CRUD)
- **商品新增**: 录入条形码、商品名、配料表、图片
- **商品查询**: 支持分页、名称模糊搜索、条形码精确搜索
- **商品修改**: 更新商品信息
- **商品删除**: 单个/批量删除

#### 1.3 智能风险识别
- **黑名单自动检测**: 检测配料表中的风险成分
  - 代可可脂、反式脂肪酸
  - 苯甲酸钠、山梨酸钾(防腐剂)
  - 人工色素、阿斯巴甜、安赛蜜(人工甜味剂)
- **风险等级自动标注**:
  - 0: 安全(无风险成分)
  - 1: 中风险(含过敏原或风险添加剂)
  - 2: 高风险(含非法添加剂，预留接口)
- **风险提示生成**: 自动生成风险说明文案

#### 1.4 资源管理
- **文件上传**: 支持商品图片上传至阿里云OSS

---

### 二、用户端功能(小程序)

#### 2.1 用户认证
- **微信登录**: 
  - 调用`wx.login()`获取临时code
  - 后端调用微信API获取openid
  - 自动注册新用户
  - 生成JWT令牌返回

#### 2.2 扫码查询 ⭐核心功能
- **条形码扫描**: 
  - 调用`wx.scanCode()`扫描商品条形码
  - 查询商品基础信息(名称、图片、配料表)
  - 展示风险分析结果
- **安全状态显示**:
  - 🟢 SAFE: 绿色卡片(无风险成分)
  - 🟡 RISK: 黄色/红色卡片(含风险成分)
  - 🔴 DANGER: 红色警示(高风险，预留)
- **配料表展示**: 配料成分标签化展示
- **风险提示**: 明确标注检测到的风险成分
- **未收录提示**: 商品不存在时引导用户等待录入

#### 2.3 关键词搜索
- **兜底方案**: 扫码失败时的备选查询方式
- **模糊匹配**: 按商品名称模糊搜索
- **结果限制**: 最多返回20条结果

#### 2.4 扫描历史
- **自动记录**: 每次扫码成功自动记录
- **历史查询**: 查看最近50条扫描记录
- **历史清空**: 一键清空所有扫描记录

---

## 🏗️ 技术架构

### 后端技术栈
- **框架**: Spring Boot 2.7.3
- **数据库**: MySQL 8.0
- **ORM**: MyBatis
- **缓存**: Redis(预留)
- **认证**: JWT(管理端/用户端分离)
- **存储**: 阿里云OSS
- **工具**: Lombok、FastJSON、PageHelper

### 前端技术栈
- **平台**: 微信小程序
- **语言**: WXML、WXSS、JavaScript
- **API**: 微信小程序API(wx.login, wx.scanCode)

### 数据库设计
- **user**: 用户表(存储微信openid)
- **product**: 商品表(条形码、配料表、风险等级)
- **scan_history**: 扫描历史表
- **employee**: 员工表(管理端账号)

---

## 🚫 V1.0 不包含的功能

### 暂不支持的功能(后续版本规划)
1. **二维码扫描**: 仅支持条形码，不支持二维码溯源
2. **OCR识别**: 不支持拍照识别配料表
3. **营养成分查询**: 不展示营养成分表
4. **过敏原管理**: 无个性化过敏原设置
5. **用户画像**: 无特殊人群标签(糖尿病、高血压等)
6. **商品收藏**: 无收藏夹功能
7. **保质期提醒**: 无库存管理和到期提醒
8. **社交功能**: 无评论、分享、社区功能
9. **营养师咨询**: 无在线咨询服务
10. **AI分析**: 无深度学习分析功能

---

## 📊 V1.0 功能完成度

| 功能模块 | 完成度 | 备注 |
|---------|-------|------|
| 管理端登录 | ✅ 100% | 已实现 |
| 商品CRUD | ✅ 100% | 已实现 |
| 黑名单检测 | ✅ 100% | 7种常见风险成分 |
| 用户登录 | ✅ 100% | 微信登录+自动注册 |
| 扫码查询 | ✅ 100% | 核心功能已实现 |
| 关键词搜索 | ✅ 100% | 兜底方案已实现 |
| 扫描历史 | ✅ 100% | 记录+查询+清空 |
| 文件上传 | ✅ 100% | OSS上传 |

---

## 🔄 后续版本开发规划

### V1.1 版本 (4周开发周期)
**主题**: 数据丰富 + 用户体验优化

#### 新增功能
1. **营养成分展示**
   - 数据库扩展: `product`表增加`nutrition_info`字段(JSON格式)
   - 前端展示: 能量、蛋白质、脂肪、碳水、钠等
   - 开发工作量: 3天

2. **商品收藏功能**
   - 新增表: `product_favorite`(用户ID、商品ID、收藏时间)
   - 接口: 收藏/取消收藏、收藏列表查询
   - 前端: 收藏按钮、"我的收藏"页面
   - 开发工作量: 2天

3. **数据批量导入**
   - 管理端: Excel导入商品数据
   - 使用POI解析Excel
   - 批量插入+校验
   - 开发工作量: 3天

4. **商品详情页优化**
   - 生产日期、保质期、生产厂商
   - 数据库扩展: `product`表增加相关字段
   - 前端UI优化
   - 开发工作量: 2天

#### 技术改进
- Redis缓存热门商品(提升查询速度)
- 分页查询优化(减少慢查询)
- 图片压缩上传(减少OSS费用)

#### 预计工作量: 10天开发 + 4天测试

---

### V1.2 版本 (5周开发周期)
**主题**: 个性化服务 + 智能推荐

#### 新增功能
1. **过敏原管理**
   - 新增表: `user_profile`(用户ID、过敏原列表、饮食偏好)
   - 扫码时自动匹配过敏原并预警
   - 前端: "个人资料"设置页面
   - 开发工作量: 5天

2. **家庭成员管理**
   - 新增表: `family_member`(用户ID、成员姓名、年龄、健康标签)
   - 支持切换成员查询(针对性风险提示)
   - 开发工作量: 4天

3. **商品评分系统**
   - 新增表: `product_review`(用户ID、商品ID、评分、评论)
   - 平均评分展示
   - 评论列表查询
   - 开发工作量: 5天

4. **搜索历史记录**
   - 记录关键词搜索历史
   - 热门搜索词统计(Redis)
   - 搜索建议功能
   - 开发工作量: 3天

5. **保质期提醒(基础版)**
   - 新增表: `product_inventory`(用户ID、商品ID、购买日期、保质期)
   - 扫码后可选"加入我的库存"
   - 到期前3天推送提醒(小程序订阅消息)
   - 开发工作量: 6天

#### 技术改进
- 引入消息队列(RabbitMQ): 异步处理历史记录、推送通知
- ElasticSearch: 优化商品搜索(支持拼音、纠错)
- 数据统计: 用户行为分析(扫码次数、收藏偏好)

#### 预计工作量: 23天开发 + 7天测试

---

### V2.0 版本 (8周开发周期)
**主题**: AI赋能 + 社交互动

#### 新增功能
1. **OCR配料表识别**
   - 集成百度OCR/腾讯OCR API
   - 拍照识别配料表文字
   - AI提取配料成分
   - 自动生成商品录入草稿
   - 开发工作量: 10天

2. **AI健康分析**
   - 集成大模型API(通义千问/文心一言)
   - 根据配料表生成健康建议
   - 适用人群分析(孕妇、儿童、老人等)
   - 开发工作量: 8天

3. **二维码溯源查询**
   - 对接国家食品溯源平台API
   - 查询生产地、检测报告
   - 展示物流信息
   - 开发工作量: 7天

4. **社区功能**
   - 新增表: `community_post`(帖子表)、`post_comment`(评论表)
   - 用户发帖分享食品体验
   - 点赞、评论功能
   - 开发工作量: 12天

5. **积分系统**
   - 新增表: `user_points`(积分记录)、`points_task`(任务表)
   - 扫码、评论、分享获取积分
   - 积分兑换优惠券(对接商家)
   - 开发工作量: 8天

6. **数据报告生成**
   - 周报/月报: 扫描次数、健康评分、风险提示统计
   - 图表可视化(ECharts)
   - PDF导出
   - 开发工作量: 6天

#### 技术改进
- 微服务架构: 拆分用户服务、商品服务、社区服务
- 分布式部署: Nginx负载均衡
- 日志监控: ELK Stack(Elasticsearch + Logstash + Kibana)
- 性能优化: CDN加速、数据库主从分离

#### 预计工作量: 51天开发 + 15天测试

---

### V3.0 版本 (10周开发周期)
**主题**: 大数据分析 + 生态建设

#### 新增功能
1. **营养师服务**
   - 新增表: `nutritionist`(营养师表)、`consultation`(咨询记录)
   - 在线预约营养师咨询
   - 视频通话功能(集成腾讯云TRTC)
   - 开发工作量: 15天

2. **食谱推荐系统**
   - 基于扫描/收藏商品推荐食谱
   - 推荐算法: 协同过滤
   - 食谱详情页(食材、步骤、营养分析)
   - 开发工作量: 12天

3. **价格对比功能**
   - 对接电商平台API(京东、淘宝)
   - 展示同款商品价格
   - 历史价格走势图
   - 开发工作量: 10天

4. **离线功能**
   - 本地缓存常用商品数据(SQLite)
   - 无网络时可查询缓存数据
   - 开发工作量: 8天

5. **企业入驻**
   - 新增表: `enterprise`(企业表)、`enterprise_product`(企业商品关联)
   - 企业自主录入商品信息
   - 企业认证审核流程
   - 开发工作量: 18天

6. **大数据分析平台**
   - 食品安全趋势分析
   - 用户画像分析
   - 热门商品排行
   - 风险预警推送
   - 开发工作量: 20天

#### 技术改进
- 大数据技术栈: Hadoop + Spark
- 实时计算: Flink
- 数据仓库: Hive
- 机器学习: TensorFlow(商品推荐、风险预测)

#### 预计工作量: 83天开发 + 20天测试

---

## 🎯 版本迭代策略

### 开发原则
1. **渐进式开发**: 每个版本基于上一版本扩展，不破坏原有功能
2. **向后兼容**: 数据库表结构扩展，不删除字段
3. **接口版本管理**: 使用`/v1/`、`/v2/`路径区分版本
4. **灰度发布**: 新功能先小范围测试，稳定后全量发布
5. **数据迁移**: 提供SQL脚本平滑升级

### 数据库演进规划

#### V1.0 → V1.1
```sql
-- 扩展商品表(增加营养成分)
ALTER TABLE product ADD COLUMN nutrition_info JSON COMMENT '营养成分JSON';

-- 新增收藏表
CREATE TABLE product_favorite (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  create_time DATETIME NOT NULL,
  UNIQUE KEY uk_user_product (user_id, product_id)
);
```

#### V1.1 → V1.2
```sql
-- 新增用户画像表
CREATE TABLE user_profile (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL UNIQUE,
  allergens JSON COMMENT '过敏原列表',
  diet_type VARCHAR(50) COMMENT '饮食偏好',
  health_tags JSON COMMENT '健康标签'
);

-- 新增家庭成员表
CREATE TABLE family_member (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  name VARCHAR(50),
  age INT,
  health_tags JSON
);

-- 新增评论表
CREATE TABLE product_review (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  rating INT COMMENT '评分1-5',
  comment TEXT,
  create_time DATETIME
);

-- 新增库存表
CREATE TABLE product_inventory (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  purchase_date DATE,
  expiry_date DATE
);
```

#### V1.2 → V2.0
```sql
-- 新增社区帖子表
CREATE TABLE community_post (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  title VARCHAR(200),
  content TEXT,
  images JSON,
  like_count INT DEFAULT 0,
  create_time DATETIME
);

-- 新增积分表
CREATE TABLE user_points (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  points INT DEFAULT 0,
  task_type VARCHAR(50),
  create_time DATETIME
);
```

### 接口演进规划

#### V1.0 接口保持不变
- `/user/user/login` - 微信登录
- `/user/product/scan/{barcode}` - 扫码查询
- `/user/product/list` - 关键词搜索
- `/user/history/list` - 历史记录

#### V1.1 新增接口
- `/user/product/favorite` - 收藏商品
- `/user/product/favorites` - 收藏列表
- `/user/product/nutrition/{id}` - 营养成分详情

#### V1.2 新增接口
- `/user/profile` - 用户画像设置
- `/user/family/members` - 家庭成员管理
- `/user/product/review` - 商品评分
- `/user/inventory` - 库存管理

#### V2.0 新增接口(独立模块)
- `/v2/ocr/analyze` - OCR识别
- `/v2/ai/analyze` - AI分析
- `/v2/community/posts` - 社区帖子
- `/v2/points/tasks` - 积分任务

---

## ⚠️ 风险评估与应对

### 技术风险
1. **微信API变更**: 定期检查微信官方文档，及时适配
2. **OSS费用超支**: 实施图片压缩、CDN缓存策略
3. **数据库性能瓶颈**: V1.2引入Redis、V2.0考虑分库分表
4. **并发压力**: V2.0引入消息队列、负载均衡

### 业务风险
1. **数据不准确**: 建立数据审核机制，用户举报功能
2. **法律合规**: 黑名单参考国家标准，定期更新
3. **隐私保护**: 遵守《个人信息保护法》，数据加密存储

### 项目管理风险
1. **需求变更**: 每个版本功能锁定后不轻易调整
2. **人员变动**: 完善文档，代码注释规范
3. **进度延期**: 预留20%缓冲时间，采用敏捷开发

---

## 📈 成功指标(KPI)

### V1.0 目标(2周内)
- ✅ 核心功能开发完成度: 100%
- ✅ 接口联调成功率: 100%
- ✅ 真机测试通过率: 95%+
- 📊 录入测试商品数: 50+条
- 📊 模拟用户测试: 10人

### V1.1 目标(4周内)
- 商品数据增长: 500+条
- 用户注册量: 100+人
- 日活跃用户: 20+人
- 收藏功能使用率: 30%+

### V1.2 目标(5周内)
- 用户注册量: 500+人
- 日活跃用户: 100+人
- 过敏原设置比例: 40%+
- 评分功能参与率: 20%+

### V2.0 目标(8周内)
- 用户注册量: 2000+人
- 日活跃用户: 500+人
- 社区活跃度: 每日10+条帖子
- OCR识别准确率: 85%+

---

## 🔒 数据安全与隐私保护

### V1.0 已实现
- JWT令牌认证
- 密码MD5加密存储
- HTTPS传输(生产环境)

### 后续版本规划
- V1.1: 用户数据脱敏(手机号、微信信息)
- V1.2: 敏感信息加密存储(AES)
- V2.0: 操作日志审计
- V3.0: 数据备份与恢复机制

---

## 📝 总结

**V1.0定位**: 最小可行产品(MVP)，聚焦核心扫码查询功能，快速验证市场需求。

**迭代策略**: 
- V1.1 丰富数据维度
- V1.2 增强个性化
- V2.0 引入AI赋能
- V3.0 构建生态闭环

**技术演进**: 单体架构 → 微服务架构 → 大数据平台

**商业模式**: 免费工具 → 增值服务(营养师咨询) → 企业服务(B端商家入驻)

---

**文档维护**: 每个版本迭代后更新本文档  
**最后更新**: 2025-12-22  
**维护人**: 项目组全体成员
