# é£Ÿå®‰å«å£« V1.0 å¼€å‘æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£è¯´æ˜
- **é¢å‘å¯¹è±¡**: åç«¯å¼€å‘äººå‘˜(5äººå°ç»„)
- **æ–‡æ¡£ç›®çš„**: æŒ‡å¯¼å¼€å‘ã€è§„èŒƒä»£ç ã€ç¡®ä¿åä½œé¡ºç•…
- **æ›´æ–°é¢‘ç‡**: é‡åˆ°é‡å¤§å˜æ›´åŠæ—¶æ›´æ–°

---

## ğŸ‘¥ å›¢é˜Ÿåˆ†å·¥

### æˆå‘˜A - Bç«¯å…¨æ ˆè´Ÿè´£äºº(ç®¡ç†åå°)
**èŒè´£**:
- ç®¡ç†ç«¯åç«¯APIå¼€å‘
- ç®¡ç†ç«¯Webå‰ç«¯å¼€å‘(HTML/CSS/JS)
- é»‘åå•æ£€æµ‹ç®—æ³•å®ç°

**æ ¸å¿ƒä»»åŠ¡**:
1. `AdminEmployeeController` - å‘˜å·¥ç™»å½•æ¥å£
2. `AdminProductController` - å•†å“CRUDæ¥å£
3. `EmployeeService` + `ProductService`(ç®¡ç†ç«¯)
4. `EmployeeMapper` + `ProductMapper`(éƒ¨åˆ†)
5. Webé¡µé¢: `login.html`, `product.html`

### æˆå‘˜B - Cç«¯åç«¯è´Ÿè´£äºº(æ ¸å¿ƒä¸šåŠ¡API)
**èŒè´£**:
- ç”¨æˆ·ç«¯åç«¯APIå¼€å‘
- å¾®ä¿¡æ¥å£å¯¹æ¥
- é…æ–™è¡¨åˆ†æç®—æ³•

**æ ¸å¿ƒä»»åŠ¡**:
1. `UserController` - å¾®ä¿¡ç™»å½•æ¥å£
2. `UserProductController` - æ‰«ç æŸ¥è¯¢ã€å…³é”®è¯æœç´¢
3. `ScanHistoryController` - æ‰«æå†å²
4. `UserService` + `UserProductService` + `ScanHistoryService`
5. `UserMapper` + `ProductMapper`(ç”¨æˆ·ç«¯æŸ¥è¯¢) + `ScanHistoryMapper`

### æˆå‘˜C - å°ç¨‹åºå‰ç«¯ä¸»åŠ›(ä¸»æµç¨‹)
**èŒè´£**:
- å°ç¨‹åºæ ¸å¿ƒé¡µé¢å¼€å‘
- æ‰«ç åŠŸèƒ½å®ç°
- å•†å“è¯¦æƒ…é¡µUI

**æ ¸å¿ƒä»»åŠ¡**:
1. é¦–é¡µ(Home): æœç´¢æ¡†ã€æ‰«ç æŒ‰é’®
2. è¯¦æƒ…é¡µ(Detail): å•†å“ä¿¡æ¯ã€é£é™©æç¤ºå¡ç‰‡
3. å¯¹æ¥æˆå‘˜Bçš„æ¥å£
4. `wx.scanCode` + `wx.request`

### æˆå‘˜D - å°ç¨‹åºè¾…åŠ© & æ•°æ®å®˜
**èŒè´£**:
- å°ç¨‹åºæ¬¡è¦é¡µé¢å¼€å‘
- æµ‹è¯•æ•°æ®å½•å…¥
- é›†æˆæµ‹è¯•

**æ ¸å¿ƒä»»åŠ¡**:
1. æˆ‘çš„(Profile)é¡µé¢
2. å†å²è®°å½•(History)é¡µé¢
3. ç™»å½•é€»è¾‘å¤„ç†
4. ä½¿ç”¨ç®¡ç†åå°å½•å…¥50+æ¡çœŸå®å•†å“æ•°æ®
5. çœŸæœºæµ‹è¯•ã€Bugåé¦ˆ

### æˆå‘˜E - é¡¹ç›®ç»ç† & æŠ€æœ¯æ”¯æŒ
**èŒè´£**:
- é¡¹ç›®è¿›åº¦ç®¡ç†
- æŠ€æœ¯éš¾ç‚¹æ”»åš
- ä»£ç Review
- æ–‡æ¡£ç»´æŠ¤

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### åç«¯ç¯å¢ƒ
```bash
# å¿…éœ€è½¯ä»¶
- JDK 1.8+
- Maven 3.6+
- MySQL 8.0
- Redis 6.0+ (å¯é€‰)
- Git

# IDEæ¨è
- IntelliJ IDEA 2021+
- VSCode (å‰ç«¯å¼€å‘)

# æ•°æ®åº“å·¥å…·
- Navicat / DBeaver / MySQL Workbench
```

### å‰ç«¯ç¯å¢ƒ(å°ç¨‹åº)
```bash
# å¿…éœ€è½¯ä»¶
- å¾®ä¿¡å¼€å‘è€…å·¥å…· 1.06+

# å¾®ä¿¡å°ç¨‹åºè´¦å·
- AppID (éœ€æå‰ç”³è¯·)
- AppSecret (éœ€æå‰ç”³è¯·)
```

### é¡¹ç›®å¯åŠ¨æ­¥éª¤

#### 1. å…‹éš†ä»£ç 
```bash
git clone <repository-url>
cd Food-Safety
```

#### 2. é…ç½®æ•°æ®åº“
```bash
# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE food_safety DEFAULT CHARSET=utf8mb4;

# æ‰§è¡Œå»ºè¡¨è„šæœ¬(è§æ¥å£æ–‡æ¡£)
source db/init.sql;
```

#### 3. ä¿®æ”¹é…ç½®æ–‡ä»¶
```yaml
# server/src/main/resources/application-dev.yml
food-safety:
  datasource:
    host: localhost        # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“åœ°å€
    port: 3306
    database: food_safety
    username: root         # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“ç”¨æˆ·å
    password: 123456       # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“å¯†ç 
  wechat:
    appid: wx1234567890    # âš ï¸ å¿…é¡»æ›¿æ¢ä¸ºçœŸå®AppID
    secret: abcdef12345    # âš ï¸ å¿…é¡»æ›¿æ¢ä¸ºçœŸå®Secret
  alioss:
    endpoint: oss-cn-hangzhou.aliyuncs.com
    access-key-id: LTAI5t...        # âš ï¸ æ›¿æ¢ä¸ºçœŸå®Key
    access-key-secret: abc123...    # âš ï¸ æ›¿æ¢ä¸ºçœŸå®Secret
    bucket-name: food-safety-images # âš ï¸ æ›¿æ¢ä¸ºçœŸå®Bucket
```

#### 4. Mavenæ„å»º
```bash
# æ ¹ç›®å½•æ‰§è¡Œ
mvn clean install

# æˆ–ä½¿ç”¨IDEAçš„Mavenå·¥å…·çª—å£
# ä¾æ¬¡æ‰§è¡Œ: clean â†’ compile â†’ install
```

#### 5. å¯åŠ¨é¡¹ç›®
```bash
# æ–¹å¼1: å‘½ä»¤è¡Œå¯åŠ¨
cd server
mvn spring-boot:run

# æ–¹å¼2: IDEAå¯åŠ¨
# å³é”®è¿è¡Œ ServerApplication.main()
```

#### 6. éªŒè¯å¯åŠ¨
```bash
# è®¿é—®æµ‹è¯•æ¥å£(å¦‚æœé…ç½®äº†Knife4j)
http://localhost:8080/doc.html

# æˆ–ç›´æ¥æµ‹è¯•æ¥å£
curl http://localhost:8080/admin/employee/login \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

### Mavenå¤šæ¨¡å—ç»“æ„
```
Food-Safety/
â”œâ”€â”€ pom.xml                 # çˆ¶POM(ä¾èµ–ç‰ˆæœ¬ç®¡ç†)
â”œâ”€â”€ common/                 # é€šç”¨æ¨¡å—(è¢«pojoå’Œserverä¾èµ–)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/com/itheima/common/
â”‚       â”œâ”€â”€ constant/      # å¸¸é‡ç±»
â”‚       â”‚   â””â”€â”€ FoodMessageConstant.java
â”‚       â”œâ”€â”€ context/       # çº¿ç¨‹ä¸Šä¸‹æ–‡
â”‚       â”‚   â””â”€â”€ BaseContext.java
â”‚       â”œâ”€â”€ enumeration/   # æšä¸¾ç±»
â”‚       â”‚   â”œâ”€â”€ RiskLevel.java
â”‚       â”‚   â””â”€â”€ ScanType.java
â”‚       â”œâ”€â”€ properties/    # é…ç½®å±æ€§ç±»
â”‚       â”‚   â”œâ”€â”€ JwtProperties.java
â”‚       â”‚   â””â”€â”€ AliOssProperties.java
â”‚       â”œâ”€â”€ result/        # ç»Ÿä¸€è¿”å›ç±»
â”‚       â”‚   â””â”€â”€ Result.java
â”‚       â””â”€â”€ untils/        # å·¥å…·ç±»
â”‚           â”œâ”€â”€ JwtUtil.java
â”‚           â”œâ”€â”€ AliOssUtil.java
â”‚           â””â”€â”€ HttpClientUtil.java
â”œâ”€â”€ pojo/                   # æ•°æ®æ¨¡å‹æ¨¡å—(è¢«serverä¾èµ–)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/com/itheima/pojo/
â”‚       â”œâ”€â”€ dto/           # æ•°æ®ä¼ è¾“å¯¹è±¡(è¯·æ±‚å‚æ•°)
â”‚       â”‚   â”œâ”€â”€ EmployeeLoginDTO.java
â”‚       â”‚   â”œâ”€â”€ ProductDTO.java
â”‚       â”‚   â”œâ”€â”€ ProductPageQueryDTO.java
â”‚       â”‚   â””â”€â”€ UserLoginDTO.java
â”‚       â”œâ”€â”€ entity/        # æ•°æ®åº“å®ä½“ç±»
â”‚       â”‚   â”œâ”€â”€ Employee.java
â”‚       â”‚   â”œâ”€â”€ Product.java
â”‚       â”‚   â”œâ”€â”€ User.java
â”‚       â”‚   â””â”€â”€ ScanHistory.java
â”‚       â””â”€â”€ vo/            # è§†å›¾å¯¹è±¡(è¿”å›æ•°æ®)
â”‚           â”œâ”€â”€ EmployeeLoginVO.java
â”‚           â”œâ”€â”€ UserLoginVO.java
â”‚           â””â”€â”€ ProductVO.java
â””â”€â”€ server/                 # æœåŠ¡æ¨¡å—(ä¸»æ¨¡å—)
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/
        â”œâ”€â”€ main/
        â”‚   â”œâ”€â”€ java/com/itheima/server/
        â”‚   â”‚   â”œâ”€â”€ ServerApplication.java   # å¯åŠ¨ç±»
        â”‚   â”‚   â”œâ”€â”€ config/                  # é…ç½®ç±»
        â”‚   â”‚   â”‚   â”œâ”€â”€ WebMvcConfiguration.java
        â”‚   â”‚   â”‚   â”œâ”€â”€ RedisConfig.java
        â”‚   â”‚   â”‚   â”œâ”€â”€ OssConfiguration.java
        â”‚   â”‚   â”‚   â””â”€â”€ PropertiesConfig.java
        â”‚   â”‚   â”œâ”€â”€ controller/              # æ§åˆ¶å™¨
        â”‚   â”‚   â”‚   â”œâ”€â”€ admin/              # ç®¡ç†ç«¯(æˆå‘˜A)
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AdminEmployeeController.java
        â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AdminProductController.java
        â”‚   â”‚   â”‚   â””â”€â”€ user/               # ç”¨æˆ·ç«¯(æˆå‘˜B)
        â”‚   â”‚   â”‚       â”œâ”€â”€ UserController.java
        â”‚   â”‚   â”‚       â”œâ”€â”€ UserProductController.java
        â”‚   â”‚   â”‚       â””â”€â”€ ScanHistoryController.java
        â”‚   â”‚   â”œâ”€â”€ handler/                 # å¼‚å¸¸å¤„ç†
        â”‚   â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java
        â”‚   â”‚   â”œâ”€â”€ interceptor/             # æ‹¦æˆªå™¨
        â”‚   â”‚   â”‚   â”œâ”€â”€ JwtTokenAdminInterceptor.java
        â”‚   â”‚   â”‚   â””â”€â”€ JwtTokenUserInterceptor.java
        â”‚   â”‚   â”œâ”€â”€ mapper/                  # MyBatisæ¥å£
        â”‚   â”‚   â”‚   â”œâ”€â”€ EmployeeMapper.java
        â”‚   â”‚   â”‚   â”œâ”€â”€ ProductMapper.java
        â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
        â”‚   â”‚   â”‚   â””â”€â”€ ScanHistoryMapper.java
        â”‚   â”‚   â””â”€â”€ service/                 # ä¸šåŠ¡é€»è¾‘å±‚
        â”‚   â”‚       â”œâ”€â”€ EmployeeService.java
        â”‚   â”‚       â”œâ”€â”€ ProductService.java
        â”‚   â”‚       â”œâ”€â”€ UserService.java
        â”‚   â”‚       â”œâ”€â”€ UserProductService.java
        â”‚   â”‚       â”œâ”€â”€ ScanHistoryService.java
        â”‚   â”‚       â””â”€â”€ impl/               # Serviceå®ç°ç±»
        â”‚   â”‚           â”œâ”€â”€ EmployeeServiceImpl.java
        â”‚   â”‚           â”œâ”€â”€ ProductServiceImpl.java
        â”‚   â”‚           â”œâ”€â”€ UserServiceImpl.java
        â”‚   â”‚           â”œâ”€â”€ UserProductServiceImpl.java
        â”‚   â”‚           â””â”€â”€ ScanHistoryServiceImpl.java
        â”‚   â””â”€â”€ resources/
        â”‚       â”œâ”€â”€ application.yml          # ä¸»é…ç½®æ–‡ä»¶
        â”‚       â”œâ”€â”€ application-dev.yml      # å¼€å‘ç¯å¢ƒé…ç½®
        â”‚       â””â”€â”€ mapper/                  # MyBatis XML
        â”‚           â”œâ”€â”€ EmployeeMapper.xml
        â”‚           â”œâ”€â”€ ProductMapper.xml
        â”‚           â”œâ”€â”€ UserMapper.xml
        â”‚           â””â”€â”€ ScanHistoryMapper.xml
        â””â”€â”€ test/
            â””â”€â”€ java/com/itheima/server/
                â””â”€â”€ ServerApplicationTests.java
```

### æ¨¡å—ä¾èµ–å…³ç³»
```
server â†’ pojo â†’ common
server â†’ common
```

---

## ğŸ’» ç¼–ç è§„èŒƒ

### Javaä»£ç è§„èŒƒ

#### å‘½åè§„èŒƒ
```java
// ç±»å: å¤§é©¼å³°
public class UserController {}

// æ–¹æ³•å: å°é©¼å³°
public Result<UserLoginVO> login() {}

// å¸¸é‡: å…¨å¤§å†™+ä¸‹åˆ’çº¿
public static final String DEFAULT_PASSWORD = "123456";

// å˜é‡: å°é©¼å³°
private String userName;

// åŒ…å: å…¨å°å†™
package com.itheima.server.controller;
```

#### æ³¨é‡Šè§„èŒƒ
```java
/**
 * ç”¨æˆ·ç™»å½•
 * @param userLoginDTO ç™»å½•å‚æ•°(codeã€userInfo)
 * @return ç”¨æˆ·ç™»å½•ä¿¡æ¯(idã€openidã€token)
 */
@PostMapping("/login")
public Result<UserLoginVO> login(@RequestBody UserLoginDTO userLoginDTO) {
    // ä¸šåŠ¡é€»è¾‘...
}
```

#### Serviceå±‚è§„èŒƒ
```java
// æ¥å£å®šä¹‰
public interface UserService {
    UserLoginVO wxLogin(UserLoginDTO userLoginDTO);
}

// å®ç°ç±»å¿…é¡»åŠ @Serviceæ³¨è§£
@Service
@Slf4j  // æ—¥å¿—
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public UserLoginVO wxLogin(UserLoginDTO userLoginDTO) {
        log.info("å¾®ä¿¡ç™»å½•ï¼Œcode: {}", userLoginDTO.getCode());
        // ä¸šåŠ¡é€»è¾‘...
    }
}
```

#### Controllerå±‚è§„èŒƒ
```java
@RestController
@RequestMapping("/user/user")
@Api(tags = "Cç«¯-ç”¨æˆ·æ¥å£")  // Swaggeræ–‡æ¡£
@Slf4j
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/login")
    @ApiOperation("å¾®ä¿¡ç™»å½•")
    public Result<UserLoginVO> login(@RequestBody UserLoginDTO userLoginDTO) {
        log.info("å¾®ä¿¡ç™»å½•è¯·æ±‚: {}", userLoginDTO);
        UserLoginVO vo = userService.wxLogin(userLoginDTO);
        return Result.success(vo);
    }
}
```

### æ•°æ®åº“è§„èŒƒ

#### è¡¨å‘½å
- å…¨å°å†™ã€ä¸‹åˆ’çº¿åˆ†éš”: `user`, `product`, `scan_history`
- é¿å…ä½¿ç”¨MySQLä¿ç•™å­—

#### å­—æ®µå‘½å
- å…¨å°å†™ã€ä¸‹åˆ’çº¿åˆ†éš”: `user_id`, `create_time`
- ä¸»é”®ç»Ÿä¸€ä½¿ç”¨`id`
- æ—¶é—´å­—æ®µ: `create_time`, `update_time`
- å¸ƒå°”å­—æ®µ: `is_deleted`, `is_enabled`

#### ç´¢å¼•è§„èŒƒ
- ä¸»é”®ç´¢å¼•: `PRIMARY KEY`
- å”¯ä¸€ç´¢å¼•: `uk_å­—æ®µå` (å¦‚: `uk_openid`)
- æ™®é€šç´¢å¼•: `idx_å­—æ®µå` (å¦‚: `idx_user_id`)

---

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 1. JWTè®¤è¯æœºåˆ¶

#### Tokenç”Ÿæˆ
```java
// ç”ŸæˆToken
Map<String, Object> claims = new HashMap<>();
claims.put("userId", user.getId());

String token = JwtUtil.createJWT(
    jwtProperties.getUserSecretKey(),  // å¯†é’¥
    jwtProperties.getUserTtl(),        // è¿‡æœŸæ—¶é—´
    claims                              // è´Ÿè½½
);
```

#### Tokenæ ¡éªŒ(æ‹¦æˆªå™¨)
```java
@Component
public class JwtTokenUserInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) {
        // 1. è·å–Token
        String token = request.getHeader("authentication");
        
        // 2. è§£æToken
        Claims claims = JwtUtil.parseJWT(secretKey, token);
        Long userId = Long.valueOf(claims.get("userId").toString());
        
        // 3. å­˜å…¥ThreadLocal
        BaseContext.setCurrentId(userId);
        
        return true;
    }
    
    @Override
    public void afterCompletion(...) {
        // æ¸…ç†ThreadLocal
        BaseContext.removeCurrentId();
    }
}
```

### 2. ThreadLocalä½¿ç”¨

#### BaseContextå·¥å…·ç±»
```java
public class BaseContext {
    private static ThreadLocal<Long> threadLocal = new ThreadLocal<>();
    
    public static void setCurrentId(Long id) {
        threadLocal.set(id);
    }
    
    public static Long getCurrentId() {
        return threadLocal.get();
    }
    
    public static void removeCurrentId() {
        threadLocal.remove();  // é˜²æ­¢å†…å­˜æ³„æ¼
    }
}
```

#### ä½¿ç”¨åœºæ™¯
```java
// Serviceå±‚è·å–å½“å‰ç”¨æˆ·ID
Long userId = BaseContext.getCurrentId();

// è®°å½•æ‰«æå†å²
ScanHistory history = ScanHistory.builder()
    .userId(userId)  // ä»ThreadLocalè·å–
    .productId(productId)
    .scanTime(LocalDateTime.now())
    .build();
```

### 3. å¾®ä¿¡ç™»å½•æµç¨‹

```java
@Override
public UserLoginVO wxLogin(UserLoginDTO userLoginDTO) {
    String code = userLoginDTO.getCode();
    
    // 1. è°ƒç”¨å¾®ä¿¡API
    String openid = getOpenid(code);
    
    // 2. æŸ¥è¯¢ç”¨æˆ·
    User user = userMapper.getByOpenid(openid);
    
    // 3. ä¸å­˜åœ¨åˆ™è‡ªåŠ¨æ³¨å†Œ
    if (user == null) {
        user = User.builder()
            .openid(openid)
            .createTime(LocalDateTime.now())
            .build();
        userMapper.insert(user);
    }
    
    // 4. ç”ŸæˆToken
    String token = JwtUtil.createJWT(...);
    
    // 5. è¿”å›ç»“æœ
    return UserLoginVO.builder()
        .id(user.getId())
        .openid(openid)
        .token(token)
        .build();
}

private String getOpenid(String code) {
    String url = "https://api.weixin.qq.com/sns/jscode2session";
    Map<String, String> params = new HashMap<>();
    params.put("appid", appid);
    params.put("secret", secret);
    params.put("js_code", code);
    params.put("grant_type", "authorization_code");
    
    String json = HttpClientUtil.doGet(url, params);
    JSONObject obj = JSON.parseObject(json);
    return obj.getString("openid");
}
```

### 4. é»‘åå•æ£€æµ‹ç®—æ³•

```java
public void save(ProductDTO productDTO) {
    Product product = new Product();
    BeanUtils.copyProperties(productDTO, product);
    
    // é»‘åå•åˆ—è¡¨
    List<String> blacklist = Arrays.asList(
        "ä»£å¯å¯è„‚", "åå¼è„‚è‚ªé…¸", "è‹¯ç”²é…¸é’ ", 
        "å±±æ¢¨é…¸é’¾", "äººå·¥è‰²ç´ ", "é˜¿æ–¯å·´ç”œ", "å®‰èµ›èœœ"
    );
    
    // æ£€æµ‹é€»è¾‘
    String ingredients = product.getJsonIngredients();
    int riskLevel = 0;
    String riskMsg = null;
    
    for (String dangerous : blacklist) {
        if (ingredients.contains(dangerous)) {
            riskLevel = 1;
            riskMsg = "æ£€æµ‹åˆ°é£é™©æˆåˆ†ï¼š" + dangerous;
            break;
        }
    }
    
    product.setRiskLevel(riskLevel);
    product.setRiskMsg(riskMsg);
    product.setCreateTime(LocalDateTime.now());
    product.setUpdateTime(LocalDateTime.now());
    product.setCreateUser(BaseContext.getCurrentId());
    
    productMapper.insert(product);
}
```

### 5. é…æ–™è¡¨è½¬æ¢é€»è¾‘

```java
private ProductVO convertToVO(Product product) {
    ProductVO vo = new ProductVO();
    BeanUtils.copyProperties(product, vo);
    
    // é…æ–™å­—ç¬¦ä¸² â†’ æ•°ç»„
    String jsonIngredients = product.getJsonIngredients();
    if (jsonIngredients != null) {
        List<String> ingredientList = Arrays.asList(
            jsonIngredients.split(",")
        );
        vo.setIngredientList(ingredientList);
    }
    
    // é£é™©ç­‰çº§ â†’ å®‰å…¨çŠ¶æ€
    Integer riskLevel = product.getRiskLevel();
    if (riskLevel == 0) {
        vo.setSafetyStatus("SAFE");
    } else if (riskLevel == 1) {
        vo.setSafetyStatus("RISK");
    } else {
        vo.setSafetyStatus("DANGER");
    }
    
    return vo;
}
```

---

## âš ï¸ å¼€å‘æ³¨æ„äº‹é¡¹

### é…ç½®ç›¸å…³
1. **é…ç½®å‰ç¼€ç»Ÿä¸€**: ä½¿ç”¨`food-safety`(ä¸æ˜¯`sky`)
2. **åŒ…åç»Ÿä¸€**: `com.itheima`(ä¸æ˜¯`com.sky`)
3. **Tokenåç§°åŒºåˆ†**: 
   - ç®¡ç†ç«¯: Header `token`
   - ç”¨æˆ·ç«¯: Header `authentication`
4. **å¾®ä¿¡é…ç½®å¿…é¡»æ›¿æ¢**: ä½¿ç”¨çœŸå®çš„appidå’Œsecret

### ä»£ç è´¨é‡
1. **ç©ºæŒ‡é’ˆæ£€æŸ¥**: ä½¿ç”¨`Optional`æˆ–æ‰‹åŠ¨åˆ¤ç©º
2. **å¼‚å¸¸å¤„ç†**: ä½¿ç”¨`@RestControllerAdvice`å…¨å±€å¼‚å¸¸å¤„ç†
3. **æ—¥å¿—è§„èŒƒ**: 
   - `log.info()` - æ­£å¸¸ä¸šåŠ¡æ—¥å¿—
   - `log.warn()` - è­¦å‘Š(å¦‚å•†å“æœªæ”¶å½•)
   - `log.error()` - é”™è¯¯(å¦‚å¾®ä¿¡æ¥å£è°ƒç”¨å¤±è´¥)
4. **äº‹åŠ¡ç®¡ç†**: Serviceå±‚æ–¹æ³•åŠ `@Transactional`(æ¶‰åŠå¤šè¡¨æ“ä½œ)

### æ•°æ®åº“ç›¸å…³
1. **ä¸»é”®è‡ªå¢**: ä½¿ç”¨`AUTO_INCREMENT`
2. **å­—æ®µé©¼å³°è½¬æ¢**: å·²é…ç½®`map-underscore-to-camel-case: true`
3. **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨MyBatisçš„`#{}`é¢„ç¼–è¯‘(ä¸è¦ç”¨`${}`)
4. **å”¯ä¸€ç´¢å¼•**: æ¡å½¢ç ã€openidã€usernameå¿…é¡»å”¯ä¸€

### å¹¶å‘å®‰å…¨
1. **ThreadLocalæ¸…ç†**: æ‹¦æˆªå™¨`afterCompletion`å¿…é¡»æ¸…ç†
2. **IDç”Ÿæˆ**: ä½¿ç”¨æ•°æ®åº“è‡ªå¢(ä¸è¦ä½¿ç”¨`UUID`)
3. **ç¼“å­˜ä¸€è‡´æ€§**: V1.0æš‚ä¸è€ƒè™‘ï¼ŒV1.1å¼•å…¥Redisåéœ€æ³¨æ„

### æ€§èƒ½ä¼˜åŒ–
1. **åˆ†é¡µæŸ¥è¯¢**: ä½¿ç”¨PageHelperï¼Œé¿å…å…¨è¡¨æ‰«æ
2. **SQLä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç´¢å¼•
3. **å›¾ç‰‡å‹ç¼©**: ä¸Šä¼ å‰å‹ç¼©(å‰ç«¯å¤„ç†)
4. **æ‡’åŠ è½½**: å›¾ç‰‡ä½¿ç”¨CDNæ‡’åŠ è½½

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•
```java
@SpringBootTest
public class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    public void testWxLogin() {
        UserLoginDTO dto = new UserLoginDTO();
        dto.setCode("test-code");
        
        UserLoginVO vo = userService.wxLogin(dto);
        
        assertNotNull(vo);
        assertNotNull(vo.getToken());
    }
}
```

### æ¥å£æµ‹è¯•(Apifox/Postman)
1. **ç¯å¢ƒå˜é‡**:
   - `baseUrl`: `http://localhost:8080`
   - `adminToken`: ç®¡ç†ç«¯ç™»å½•åçš„Token
   - `userToken`: ç”¨æˆ·ç«¯ç™»å½•åçš„Token

2. **æµ‹è¯•æµç¨‹**:
   ```
   1. ç®¡ç†ç«¯ç™»å½• â†’ ä¿å­˜adminToken
   2. å•†å“æ–°å¢ â†’ ä½¿ç”¨adminToken
   3. ç”¨æˆ·ç«¯ç™»å½• â†’ ä¿å­˜userToken
   4. æ‰«ç æŸ¥è¯¢ â†’ ä½¿ç”¨userToken
   ```

### çœŸæœºæµ‹è¯•
1. **å°ç¨‹åºçœŸæœºè°ƒè¯•**:
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»"çœŸæœºè°ƒè¯•"
   - æ‰«ç ååœ¨æ‰‹æœºä¸Šæµ‹è¯•

2. **æµ‹è¯•ç”¨ä¾‹**:
   - æ‰«æçœŸå®å•†å“æ¡å½¢ç 
   - ç½‘ç»œæ–­å¼€æ—¶çš„å…œåº•å¤„ç†
   - æœªæ”¶å½•å•†å“çš„æç¤º

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. å¯åŠ¨å¤±è´¥

**é—®é¢˜**: ç«¯å£è¢«å ç”¨
```bash
# è§£å†³æ–¹æ¡ˆ
netstat -ano | findstr 8080
taskkill /PID <è¿›ç¨‹ID> /F
```

**é—®é¢˜**: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
net start mysql

# æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç 
```

### 2. æ¥å£401

**é—®é¢˜**: Tokenæ— æ•ˆæˆ–è¿‡æœŸ
- æ£€æŸ¥Tokenæ˜¯å¦åœ¨Headerä¸­
- æ£€æŸ¥Tokenåç§°(ç®¡ç†ç«¯`token` / ç”¨æˆ·ç«¯`authentication`)
- é‡æ–°ç™»å½•è·å–æ–°Token

### 3. å¾®ä¿¡ç™»å½•å¤±è´¥

**é—®é¢˜**: openidè¿”å›null
- æ£€æŸ¥appidå’Œsecretæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥codeæ˜¯å¦å·²ä½¿ç”¨è¿‡(å¾®ä¿¡codeåªèƒ½ç”¨ä¸€æ¬¡)
- æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„å¾®ä¿¡APIè¿”å›ç»“æœ

### 4. MyBatisæ‰¾ä¸åˆ°Mapper

**é—®é¢˜**: `Invalid bound statement`
- æ£€æŸ¥XMLæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®(`resources/mapper/`)
- æ£€æŸ¥XMLçš„namespaceæ˜¯å¦ä¸Mapperæ¥å£å…¨é™å®šåä¸€è‡´
- é‡æ–°ç¼–è¯‘é¡¹ç›®(`mvn clean compile`)

### 5. å›¾ç‰‡ä¸Šä¼ å¤±è´¥

**é—®é¢˜**: OSSé…ç½®é”™è¯¯
- æ£€æŸ¥`access-key-id`å’Œ`access-key-secret`
- æ£€æŸ¥`bucket-name`æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥bucketæƒé™è®¾ç½®(éœ€è¦å…è®¸å…¬ç½‘ä¸Šä¼ )

---

## ğŸ“¦ éƒ¨ç½²æŒ‡å—

### æœ¬åœ°éƒ¨ç½²(å¼€å‘é˜¶æ®µ)
```bash
# 1. æ‰“åŒ…
mvn clean package

# 2. è¿è¡ŒjaråŒ…
java -jar server/target/server-1.0-SNAPSHOT.jar

# 3. æŒ‡å®šç¯å¢ƒ
java -jar server/target/server-1.0-SNAPSHOT.jar --spring.profiles.active=dev
```

### æœåŠ¡å™¨éƒ¨ç½²(ç”Ÿäº§ç¯å¢ƒ)

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…JDK
sudo apt install openjdk-8-jdk

# å®‰è£…MySQL
sudo apt install mysql-server

# å®‰è£…Redis(å¯é€‰)
sudo apt install redis-server
```

#### 2. ä¿®æ”¹ç”Ÿäº§é…ç½®
åˆ›å»º`application-prod.yml`:
```yaml
food-safety:
  datasource:
    host: your-prod-db-host
    username: prod_user
    password: strong_password
  wechat:
    appid: your-prod-appid
    secret: your-prod-secret
```

#### 3. åå°è¿è¡Œ
```bash
nohup java -jar server-1.0-SNAPSHOT.jar --spring.profiles.active=prod > app.log 2>&1 &
```

#### 4. Nginxåå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name api.foodsafety.com;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### å°ç¨‹åºéƒ¨ç½²
1. ä¸Šä¼ ä»£ç åˆ°å¾®ä¿¡å…¬ä¼—å¹³å°
2. é…ç½®æœåŠ¡å™¨åŸŸåç™½åå•
3. æäº¤å®¡æ ¸
4. å®¡æ ¸é€šè¿‡åå‘å¸ƒ

---

## ğŸ“Š é¡¹ç›®è¿›åº¦ç®¡ç†

### Week 1 (Day 1-7)
- **Day 1**: ç¯å¢ƒæ­å»ºã€æ•°æ®åº“å»ºè¡¨
- **Day 2-3**: ç®¡ç†ç«¯å¼€å‘(æˆå‘˜A)
- **Day 2-4**: ç”¨æˆ·ç«¯åç«¯å¼€å‘(æˆå‘˜B)
- **Day 3-5**: å°ç¨‹åºå‰ç«¯å¼€å‘(æˆå‘˜Cã€D)
- **Day 6**: æ¥å£è”è°ƒ
- **Day 7**: æ•°æ®å½•å…¥(æˆå‘˜D)

### Week 2 (Day 8-14)
- **Day 8-9**: Bugä¿®å¤
- **Day 10-11**: çœŸæœºæµ‹è¯•
- **Day 12**: æ€§èƒ½ä¼˜åŒ–
- **Day 13**: æ–‡æ¡£å®Œå–„
- **Day 14**: é¡¹ç›®éªŒæ”¶

---

## ğŸ”— ç›¸å…³æ–‡æ¡£é“¾æ¥

- [åŠŸèƒ½æ–‡æ¡£](./v1.0åŠŸèƒ½æ–‡æ¡£.md)
- [æ¥å£æ–‡æ¡£](./v1.0æ¥å£æ–‡æ¡£.md)
- [æ•°æ®åº“å»ºè¡¨è„šæœ¬](./db/init.sql)
- [å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [MyBatiså®˜æ–¹æ–‡æ¡£](https://mybatis.org/mybatis-3/zh/index.html)

---

**æ–‡æ¡£ç»´æŠ¤**: é¡¹ç›®ç»„å…¨ä½“æˆå‘˜  
**æœ€åæ›´æ–°**: 2025-12-22  
**è”ç³»æ–¹å¼**: é¡¹ç›®ç»„å†…éƒ¨æ²Ÿé€š
